import { parse } from 'graphql';
import { gqlPluckFromFile } from 'graphql-tag-pluck';
function calculateOptions(options) {
    if (!options || !options.pluckConfig) {
        return {};
    }
    // toolkit option's key -> option in graphql-tag-pluck
    const keyMap = {
        modules: 'modules',
        magicComment: 'gqlMagicComment',
        globalIdentifier: 'globalGqlIdentifierName',
    };
    return Object.keys(keyMap).reduce((prev, curr) => {
        const value = options.pluckConfig[curr];
        if (value) {
            return {
                ...prev,
                [keyMap[curr]]: value,
            };
        }
        return prev;
    }, {});
}
export async function extractDocumentStringFromCodeFile(source, options) {
    try {
        const parsed = parse(source.body);
        if (parsed) {
            return source.body;
        }
    }
    catch (e) {
        try {
            return (await gqlPluckFromFile(source.name, calculateOptions(options))) || null;
        }
        catch (e) {
            throw new e.constructor(`${e.message} at ${source.name}`);
        }
    }
}
//# sourceMappingURL=extract-document-string-from-code-file.js.map